{% extends "base.html" %}
{% block title %}Analysis Result – {{ data.filename }}{% endblock %}

{% block extra_head %}
<style>
  .score-circle svg { transform: rotate(-90deg); }
</style>
{% endblock %}

{% block content %}

<!-- ── Result Hero ─────────────────────────────────────────────────────────── -->
<section class="result-hero">
  <div class="result-hero-inner">
    <div class="result-meta">
      <div class="result-badge">
        {% if data.score >= 80 %}
          <i class="fas fa-trophy text-green"></i> Excellent Match
        {% elif data.score >= 60 %}
          <i class="fas fa-thumbs-up text-aqua"></i> Good Match
        {% elif data.score >= 40 %}
          <i class="fas fa-exclamation-triangle text-yellow"></i> Fair Match
        {% else %}
          <i class="fas fa-times-circle text-pink"></i> Needs Work
        {% endif %}
      </div>
      <h1 class="result-title">Resume Analysis Complete</h1>
      <p class="result-subtitle">
        <i class="fas fa-file-alt"></i> {{ data.filename }}
        {% if data.job_title %}· <i class="fas fa-briefcase"></i> {{ data.job_title }}{% endif %}
        · <i class="fas fa-clock"></i> {{ data.created_at }}
      </p>
    </div>

    <!-- Score Circle -->
    <div class="score-circle-wrap">
      <div class="score-circle" data-score="{{ data.score }}">
        <svg viewBox="0 0 120 120" width="160" height="160">
          <circle class="track" cx="60" cy="60" r="54" fill="none" stroke-width="10"/>
          <circle class="fill" cx="60" cy="60" r="54" fill="none" stroke-width="10"
                  stroke-dasharray="{{ (data.score / 100 * 339.29) | round(2) }} 339.29"
                  id="scoreFill"/>
        </svg>
        <div class="score-text">
          <span class="score-number" id="scoreNumber">0</span>
          <span class="score-label">/ 100</span>
        </div>
      </div>
      <p class="score-desc">
        {% if data.score >= 80 %}Your resume is highly tailored for this role!
        {% elif data.score >= 60 %}Strong resume with room for improvement.
        {% elif data.score >= 40 %}Resume needs targeted optimisation.
        {% else %}Significant gaps found. Follow the suggestions below.
        {% endif %}
      </p>
    </div>
  </div>

  <!-- Sub-scores -->
  <div class="sub-scores">
    <div class="sub-score-card glass-card">
      <i class="fas fa-key text-aqua"></i>
      <div>
        <span class="sub-label">Keyword Match</span>
        <div class="mini-bar">
          <div class="mini-fill" style="width:{{ data.keyword_score }}%"></div>
        </div>
        <span class="sub-value">{{ data.keyword_score }}%</span>
      </div>
    </div>
    <div class="sub-score-card glass-card">
      <i class="fas fa-tools text-pink"></i>
      <div>
        <span class="sub-label">Skills Match</span>
        <div class="mini-bar">
          <div class="mini-fill pink" style="width:{{ data.skills_score }}%"></div>
        </div>
        <span class="sub-value">{{ data.skills_score }}%</span>
      </div>
    </div>
    <div class="sub-score-card glass-card">
      <i class="fas fa-align-left text-aqua"></i>
      <div>
        <span class="sub-label">Format Score</span>
        <div class="mini-bar">
          <div class="mini-fill" style="width:{{ data.format_score }}%"></div>
        </div>
        <span class="sub-value">{{ data.format_score }}%</span>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="result-actions">
    <a href="{{ url_for('download_report', uid=data.uid) }}" class="btn-primary">
      <i class="fas fa-download"></i> Download PDF Report
    </a>
    <a href="{{ url_for('index') }}" class="btn-secondary">
      <i class="fas fa-redo"></i> Analyze Another
    </a>
  </div>
</section>

<!-- ── Analysis Cards ─────────────────────────────────────────────────────── -->
<section class="analysis-grid">

  <!-- Matched Keywords -->
  <div class="analysis-card glass-card slide-in" style="--delay:0.1s">
    <div class="card-header-colored green-header">
      <i class="fas fa-check-circle"></i>
      <h3>Matched Keywords</h3>
      <span class="count-badge">{{ data.matched_keywords | length }}</span>
    </div>
    <div class="tag-cloud">
      {% if data.matched_keywords %}
        {% for kw in data.matched_keywords %}
          <span class="tag tag-green">{{ kw }}</span>
        {% endfor %}
      {% else %}
        <p class="empty-msg">No matching keywords found.</p>
      {% endif %}
    </div>
  </div>

  <!-- Missing Keywords -->
  <div class="analysis-card glass-card slide-in" style="--delay:0.2s">
    <div class="card-header-colored red-header">
      <i class="fas fa-times-circle"></i>
      <h3>Missing Keywords</h3>
      <span class="count-badge">{{ data.missing_keywords | length }}</span>
    </div>
    <div class="tag-cloud">
      {% if data.missing_keywords %}
        {% for kw in data.missing_keywords %}
          <span class="tag tag-red">{{ kw }}</span>
        {% endfor %}
      {% else %}
        <p class="empty-msg">Great – no critical keywords missing!</p>
      {% endif %}
    </div>
  </div>

  <!-- Matched Skills -->
  <div class="analysis-card glass-card slide-in" style="--delay:0.3s">
    <div class="card-header-colored teal-header">
      <i class="fas fa-code"></i>
      <h3>Skills You Have</h3>
      <span class="count-badge">{{ data.matched_skills | length }}</span>
    </div>
    <div class="skills-list">
      {% if data.matched_skills %}
        {% for skill in data.matched_skills %}
          <div class="skill-row">
            <i class="fas fa-check text-green"></i>
            <span>{{ skill }}</span>
          </div>
        {% endfor %}
      {% else %}
        <p class="empty-msg">No matching skills detected from JD.</p>
      {% endif %}
    </div>
  </div>

  <!-- Missing Skills -->
  <div class="analysis-card glass-card slide-in" style="--delay:0.4s">
    <div class="card-header-colored pink-header">
      <i class="fas fa-plus-circle"></i>
      <h3>Skills to Add</h3>
      <span class="count-badge">{{ data.missing_skills | length }}</span>
    </div>
    <div class="skills-list">
      {% if data.missing_skills %}
        {% for skill in data.missing_skills %}
          <div class="skill-row">
            <i class="fas fa-times text-pink"></i>
            <span>{{ skill }}</span>
          </div>
        {% endfor %}
      {% else %}
        <p class="empty-msg">You have all the required skills!</p>
      {% endif %}
    </div>
  </div>

  <!-- AI Suggestions -->
  <div class="analysis-card glass-card slide-in wide-card" style="--delay:0.5s">
    <div class="card-header-colored blue-header">
      <i class="fas fa-lightbulb"></i>
      <h3>AI Improvement Suggestions</h3>
    </div>
    <div class="suggestions-list">
      {% if data.suggestions %}
        {% for idx, suggestion in data.suggestions | enumerate %}
          <div class="suggestion-item">
            <div class="suggestion-num">{{ idx + 1 }}</div>
            <p>{{ suggestion }}</p>
          </div>
        {% endfor %}
      {% else %}
        <p class="empty-msg">No suggestions – your resume looks great!</p>
      {% endif %}
    </div>
  </div>

  <!-- ATS Check -->
  <div class="analysis-card glass-card slide-in wide-card" style="--delay:0.6s">
    <div class="card-header-colored {% if data.ats_issues %}yellow-header{% else %}green-header{% endif %}">
      <i class="fas fa-robot"></i>
      <h3>ATS Compatibility Check</h3>
      {% if data.ats_issues %}
        <span class="count-badge badge-yellow">{{ data.ats_issues | length }} issues</span>
      {% else %}
        <span class="count-badge badge-green">Passed</span>
      {% endif %}
    </div>
    {% if data.ats_issues %}
      <div class="ats-list">
        {% for issue in data.ats_issues %}
          <div class="ats-item">
            <i class="fas fa-exclamation-triangle text-yellow"></i>
            <p>{{ issue }}</p>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="ats-pass">
        <i class="fas fa-check-circle text-green fa-2x"></i>
        <p>No major ATS issues detected. Your resume should parse correctly in most systems.</p>
      </div>
    {% endif %}
  </div>

</section>

<!-- Success animation trigger -->
<div class="success-confetti" id="confetti"></div>

{% endblock %}

{% block extra_scripts %}
<script>
  // Pass score to JS for animation
  window.RESUME_SCORE = {{ data.score }};
</script>
<script src="{{ url_for('static', filename='js/result.js') }}"></script>
{% endblock %}
